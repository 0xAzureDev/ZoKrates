Fix false positives and false negatives in struct generic inference
